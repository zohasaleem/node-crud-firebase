<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width">
    <title>ZIMOMEET® | ZM® | Premium Video Meetings | Instant Meetings | Share Videos | No Registration | Free-to-use and Unlimited. Discover One Platform. Together, we create and build a better world.</title>
    <meta name="author">
    <meta name="description" content="ZIMOMEET® is a Communications Technology Company and a proprietary video telephony software program developed by ZIMO GROUP. The ZM® platform allows participants unlimited time restrictions with extensive features. ZM® is free-to-use worldwide.">
    <meta property="og:title" content="ZIMOMEET® | ZM® | Premium Video Meetings | Instant Meetings | Share Videos | No Registration | Free-to-use and Unlimited. Discover One Platform. Together, we create and build a better world.">
    <meta property="og:type" content="website">
    <meta property="og:image" content="https://zimomeet.com/assets/ZM-CAM-B-200x200.png">
    <meta name="twitter:title" content="ZIMOMEET® | ZM® | Premium Video Meetings | Instant Meetings | Share Videos | No Registration | Free-to-use and Unlimited. Discover One Platform. Together, we create and build a better world.">
    <meta name="twitter:description" content="ZIMOMEET® is a Communications Technology Company and a proprietary video telephony software program developed by ZIMO GROUP. The ZM® platform allows participants unlimited time restrictions with extensive features. ZM® is free-to-use worldwide.">
    <meta name="twitter:image" content="https://zimomeet.com/assets/ZM-CAM-B-200x200.png"><meta name="twitter:card" content="summary_large_image"><link rel="shortcut icon" href="/assets/favicon.ico" type="image/x-icon">
    <meta name="next-head-count" content="13">
    <title>CMS CRUD</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script></head>
    <link href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">

    <body>
        <div class="container">
            <div class="row">
                <div class="col mt-4 mb-4">
                        <h1 class="mt-4 d-inline" >CMS CRUD</h1>
                        <button type="button" class="btn btn-primary float-right" data-toggle="modal" data-target="#uploadModal">
                            Add Record
                        </button>
                </div>
            </div>


            <div class="row">

                <div class="table-responsive">

                    <table id="records" class="table table-striped">
                        <thead>
                            <tr>
                                <th>Type</th>
                                <th>Key</th>
                                <th>Value</th>
                                <th>Actions</th>

                            </tr>
                        </thead>
                        <tbody>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

    <!-- Modal -->
    <div class="modal fade" id="uploadModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered modal-lg" role="document">
        <div class="modal-content">
            <div class="modal-header">
            <h5 class="modal-title" id="exampleModalLongTitle">Add Record</h5>
            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                <span aria-hidden="true">&times;</span>
            </button>
            </div>
            <div class="modal-body">
                <form id="cmsForm">
                    <label for="cmskey">Key:</label>
                    <input type="text" id="cmskey" name="cmskey" class="form-control" >

                    
                    <label for="type">Type:</label>
                    <select id="type" class="form-control"  >
                        <option value="text">Text</option>
                        <option value="image">Image</option>
                    </select>
            
            
                    <div id="valueField">
                        <label for="value">Value:</label>
                        <textarea id="value" name="value" class="form-control"></textarea>
                    </div>
            
            
                    <div id="fileInputField" style="display: none;">
                        <label for="image">Image:</label>
                        <input type="file" id="image" name="image" class="form-control-file"><br>
                    </div>
                    
            
                    <button type="submit" class="btn btn-primary">Submit</button>
                </form>
            </div>
           
        </div>
        </div>
    </div>


    <!-- Bootstrap modal for editing record -->
    <div class="modal" id="editModal">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h4 class="modal-title">Edit Record</h4>
                    <button type="button" class="close" data-dismiss="modal">&times;</button>
                </div>

                <input type="hidden" id="key" name="key">

                <div class="modal-body">


                    <label for="editKey">Key:</label>
                    <input type="text" id="editKey" class="form-control" ><br>

                
                    <label for="editType">Type:</label>
                    <select id="editType" class="form-control" >
                        <option value="text">Text</option>
                        <option value="image">Image</option>
                    </select><br>

                    
                    <div id="editValueField" style="display: none;">
                        <label for="value">Value:</label>
                        <textarea id="editValue" class="form-control" ></textarea>
                    </div>

                    <div id="editFileInputField" style="display: none;">
                        <label for="editImage">Image:</label>
                        <input type="file" id="editImage" name="editImage"  class="form-control-file"><br>
                    </div>

                    <div id="currentImage" style="display: none;">
                        <img src="" id="displayCurrentImage" alt="no-image" width="200" height="200" />
                    </div>

                </div>

                <div class="modal-footer">
                    <button type="button" class="btn btn-primary" id="updateBtn">Update</button>
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                </div>

            </div>
        </div>
    </div>
    

    <div id="message"></div>



    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.0/umd/popper.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>

    <script
        type="text/javascript"
        src='https://cdn.tiny.cloud/1/fge66p60nzrcg97eosvndgpcz5th7jijtev7yie4h2mbvmz8/tinymce/6/tinymce.min.js'
        referrerpolicy="origin">
    </script>
    
    <script>
        tinymce.init({
            selector: '#value',
            plugins: 'anchor autolink charmap codesample emoticons image link lists media searchreplace table visualblocks wordcount linkchecker',
            toolbar: 'undo redo | blocks fontfamily fontsize | bold italic underline strikethrough | link image media table | align lineheight | numlist bullist indent outdent | emoticons charmap | removeformat',
            height: 400
        });
    
        tinymce.init({
            selector: '#editValue',
            plugins: 'anchor autolink charmap codesample emoticons image link lists media searchreplace table visualblocks wordcount linkchecker',
            toolbar: 'undo redo | blocks fontfamily fontsize | bold italic underline strikethrough | link image media table | align lineheight | numlist bullist indent outdent | emoticons charmap | removeformat',
            height: 400
        });

    </script>
    
     
    <script>
        $(document).ready(function() {


            $('#type').change(function() {
                const selectedType = $(this).val();
                if (selectedType === 'text') {
                    $('#valueField').show();
                    $('#fileInputField').hide();
                } else if (selectedType === 'image') {
                    $('#valueField').hide();
                    $('#fileInputField').show();
                }
            });



            $.ajax({
                type: 'GET',
                url: '/cms',
                success: function(response){
                    const cms = response.cms;
                    if(cms){
                        Object.keys(cms).forEach(key => {
                            let valueHtml = '';
                            if(cms[key].type === 'text'){
                                valueHtml = cms[key].value;
                            }
                            else if(cms[key].type === 'image'){
                                valueHtml = `<img src="${cms[key].value}" alt="no-image" width=100 height=100/>`
                            }

                            $('#records tbody').append(`
                                <tr>
                                    <td>${cms[key].type}</td>
                                    <td>${cms[key].key}</td>
                                    <td>${valueHtml}</td>
                                    <td><button class="btn btn-sm btn-primary edit-btn" data-key="${key}">Edit</button>
                                    <button class="btn btn-sm btn-danger delete-btn" data-key="${key}">Del</button></td>
                                </tr>
                            `);
                        });
                    }
                },
                error: function(err) {
                    console.log('Error fetching records:', err);
                }
            });
            


            $('#cmsForm').submit(function(e){
                e.preventDefault();

                var formData = new FormData();
                formData.append('cmskey', $('#cmskey').val());
                formData.append('value', tinymce.get('value').getContent());
                // formData.append('value', $('#value').val());
                formData.append('type', $('#type').val());
                formData.append('image', $('#image')[0].files[0]);

                console.log("Form Data:", formData);

                $.ajax({
                    type: 'POST',
                    url: '/cms',
                    data: formData,
                    processData: false,  
                    contentType: false, 
                    success: function(response)
                    {
                        $('.alert-success').text(response.message);
                        location.reload();
                    },
                    error: function(err)
                    {
                        $('.alert-success').text('Error: ' + err.responseText);
                    },
                    complete: function(){
                        $('#uploadModal').modal('hide');
                    }
                });

            });



            $(document).on('click', '.edit-btn', function() {
                const key = $(this).data('key');

                $.ajax({
                    type: 'GET',
                    url: `/cms/${key}`,
                    success: function(response) {
                        const cms = response.cms;
                        if (cms) {
                            $('#key').val(key);
                            $('#editKey').val(cms.key);
                            $('#editType').val(cms.type);
                            $('#editValue').val(cms.value);

                            if(cms.type === 'image'){
                                $('#displayCurrentImage').attr('src', cms.value);
                                $('#editFileInputField').show();
                                $('#editValueField').hide();
                                $('#currentImage').show();
                            } 
                            else{
                                
                                $('#editValue').val(cms.value);
                                tinymce.get('editValue').setContent(cms.value);
                                $('#editValueField').show();
                                $('#editFileInputField').hide();
                                $('#currentImage').hide();
                            }

                            $('#editType').change(function() {
                                const newType = $(this).val();
                                if(newType === 'image'){
                                    $('#displayCurrentImage').attr('src', cms.value);
                                    $('#currentImage').show();
                                    $('#editFileInputField').show();
                                    $('#editValueField').hide();

                                } 
                                else if(newType === 'text'){

                                    tinymce.get('editValue').setContent(cms.value);
                                    tinymce.get('editValue').getContent();
                                    $('#editValue').val('');
                                    $('#editValueField').show();
                                    $('#editFileInputField').hide();
                                    $('#currentImage').hide();

                                }
                            });

                            $('#editModal').modal('show');
                        }
                    },
                    error: function(err) {
                        console.log('Error fetching record:', err);
                    }
                });
            });



            // $('#updateBtn').click(function() {
            //     const key = $('#key').val();
            //     const newCmskey = $('#editKey').val();
            //     const newValue = $('#editValue').val();
            //     const newType = $('#editType').val();

            //     $.ajax({
            //         type: 'PUT',
            //         url: `/cms/${key}`,
            //         data: { key: newCmskey, value: newValue, type: newType },
            //         success: function(response) {
            //             $('#message').text(response.message);
            //             location.reload();
            //         },
            //         error: function(err) {
            //             $('#message').text('Error: ' + err.responseText);
            //         },
            //         complete: function(){
            //             $('#editModal').modal('hide');
            //         }
            //     });
            // });

            

            $('#updateBtn').click(function() {
                const key = $('#key').val();
                const newCmskey = $('#editKey').val();
                const newValue = tinymce.get('editValue').getContent();
                const newType = $('#editType').val();

                const formData = new FormData();
                formData.append('key', newCmskey);
                formData.append('value', newValue);
                formData.append('type', newType);
                formData.append('editValue', newValue);

                const editImage = $('#editImage')[0].files[0];
                if (editImage) {
                    formData.append('editImage', editImage);
                }
                console.log(formData);

                $.ajax({
                    type: 'PUT',
                    url: `/cms/${key}`,
                    data: formData,
                    processData: false,
                    contentType: false,
                    success: function(response) {
                        $('.alert-success').text(response.message);
                        console.log(response);
                        location.reload();
                    },
                    error: function(err) {
                        $('.alert-success').text('Error: ' + err.responseText);
                    },
                    complete: function(){
                        $('#editModal').modal('hide');
                    }
                });
            });





            $(document).on('click', '.delete-btn', function() {
                const key = $(this).data('key');

                if (confirm('Are you sure you want to delete this record?')) {
                    $.ajax({
                        type: 'DELETE',
                        url: `/cms/${key}`,
                        success: function(response) {
                            $('.alert-success').text(response.message);
                            location.reload();
                        },
                        error: function(err) {
                            $('.alert-success').text('Error: ' + err.responseText);
                        }
                    });
                }
            });

        });
    </script>
</body>
</html>
